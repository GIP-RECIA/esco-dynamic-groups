<?xml version="1.0" encoding="UTF-8" ?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd">

	<bean id="parameters" class="org.esco.dynamicgroups.domain.beans.ESCODynamicGroupsParameters">
		<constructor-arg value="resources/esco-dynamic-groups.properties" />
	</bean>
	
	<bean id="i18nService" class="org.springframework.context.support.ResourceBundleMessageSource">
		<property name="basenames">
			<list>
				<value>resources/i18n/statistics</value>
			</list>
		</property>
	</bean>
	
	
	
	<bean id="i18n" class="org.esco.dynamicgroups.domain.beans.I18NManager">
		<property name="parameters" ref="parameters"/>
		<property name="messageSource" ref="i18nService"/>
	</bean>
	<bean id="xhtmlReportFormatter" class="org.esco.dynamicgroups.domain.reporting.XHTMLReportFormatter"/>
	<bean id="textReportFormatter" class="org.esco.dynamicgroups.domain.reporting.TextReportFormatter"/>
	<bean id="reportFormatter" class="org.esco.dynamicgroups.domain.reporting.ReportFormatter">
		<property name="xhtmlFormatter" ref="xhtmlReportFormatter"/>
		<property name="textFormatter" ref="textReportFormatter"/>
		<property name="parameters" ref="parameters"/>
	</bean>
	<bean id="statisticsManager" class="org.esco.dynamicgroups.domain.reporting.statistics.StatisticsManager">
		<property name="parameters" ref="parameters"/>
		<property name="i18n" ref="i18n"/>
		<property name="reportFormatter" ref="reportFormatter"/>
		<property name="groupsService" ref="groupsService"/>
	</bean>
	
	<bean id="statisticsManagerProvider" class="org.esco.dynamicgroups.domain.reporting.statistics.StatisticsManagerProviderForHooks">
		<property name="statisticsManager" ref="statisticsManager"/>
	</bean>
	
	<bean id="hooksInstaller" class="org.esco.dynamicgroups.hooks.ESCOHooksInstaller" depends-on="parameters, statisticsManagerProvider"/>

	
	<bean id="mailer" class="org.esco.dynamicgroups.util.Mailer">
		<property name="parameters" ref="parameters"/>
	</bean>
	
	
	
	<bean name="reportingJob" class="org.springframework.scheduling.quartz.JobDetailBean">
  		<property name="jobClass" value="org.esco.dynamicgroups.domain.reporting.ReportingJob"/>
  		<property name="jobDataAsMap">
    		<map>
     	 		<entry key="statisticsManager" value-ref="statisticsManager"/>
     	 		<entry key="mailer" value-ref="mailer"/>
     	 		<entry key="i18n" value-ref="i18n"/>
     	 		<entry key="reportFormatter" value-ref="reportFormatter"/>
    		</map>
  		</property>
	</bean>
	
	<bean id="cronTrigger" class="org.esco.dynamicgroups.domain.reporting.ReportingTrigger" depends-on="parameters">
		<constructor-arg ref="parameters"/>
		<property name="jobDetail" ref="reportingJob"/>
	</bean>
	<bean class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
  		<property name="triggers">
    		<list>
      			<ref bean="cronTrigger"/>
    		</list>
  		</property>
	</bean>
	
	<bean id="repositoryListener" class="org.esco.dynamicgroups.domain.SyncReplClientListenerImpl">
		<property name="syncReplClient" ref="synReplClient" />
		<property name="exceptionHandlerFactory" ref="uncaughtExceptionHandlerFactory" />
	</bean>
	
	<bean id="uncaughtExceptionHandlerFactory" class="org.esco.dynamicgroups.exceptions.UncaughtExceptionHandlerFactoryImpl">
		<property name="listener" ref="repositoryListener"/>
		<property name="mailer" ref="mailer"/>
	</bean>
	
	<bean id="domainService" class="org.esco.dynamicgroups.domain.ESCODomainServiceImpl"
		  depends-on="parameters">
		<property name="daoService" ref="daoService" />
		<property name="groupsService" ref="groupsService" />
		<property name="repositoryListener" ref="repositoryListener" />
	</bean>
	
	
	

</beans>